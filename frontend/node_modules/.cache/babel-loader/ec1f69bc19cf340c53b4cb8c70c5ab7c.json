{"ast":null,"code":"var _jsxFileName = \"/home/marta/Dokumenty/DYPLOM/copper_shop_template/src/components/shop/basket/basket_step_3/BasketStep3.js\";\nimport React, { Component } from 'react';\nimport \"./_basket_step_3.scss\";\nimport BasketTableProducts from \"../basket_table/basket_table_products/BasketTableProducts\";\nimport BasketTableSummary from \"../basket_table/basket_table_summary/BasketTableSummary\";\n\nclass BasketStep3 extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      products: []\n    };\n\n    this.handleSubmit = e => {\n      e.preventDefault();\n      const {\n        products\n      } = this.state;\n      const {\n        setBasketStep,\n        basketStep,\n        basketSetClear,\n        basket\n      } = this.props;\n      setBasketStep(basketStep + 1);\n      let newProductsList = [...products];\n      let error = false;\n      let changeId = [];\n      let i = 0;\n\n      for (; i < basket.length;) {\n        console.log(\"pętla\");\n\n        for (let j = 0; j < products.length; j++) {\n          console.log(\"pętla2\");\n\n          if (products[j].id === basket[i].product.id) {\n            changeId.push(j);\n            newProductsList[j].quantity2 = (+products[j].quantity2 - +basket[i].amount).toString();\n            let difference = +products[j].quantity2 - +basket[i].amount;\n\n            if (difference < 0) {\n              console.log(\"Ktoś już kupił produkt z twojego koszyka\");\n              error = true;\n            }\n          }\n        }\n\n        i++;\n      }\n\n      console.log(newProductsList);\n      let newProductsList2 = [];\n\n      for (let i = 0; i < newProductsList.length; i++) {\n        if (newProductsList[i] !== \"empty\") {\n          newProductsList2.push(newProductsList[i]);\n        }\n      }\n\n      console.log(newProductsList2);\n\n      if (i >= basket.length && !error) {\n        // const formData = new FormData();\n        // formData.append(\"products\", JSON.stringify(newProductsList2))\n        // //console.log(JSON.stringify(products));\n        // const data = {products: newProductsList2}\n        //\n        // console.log(data);\n        // console.log(JSON.stringify(data));\n        // const formData = new FormData();\n        //\n        //\n        // formData.append();\n        // for (let i = 0; i < newProductsList2.length; i++) {\n        //     formData.append('id', newProductsList2[i]);\n        // }\n        const url = \"http://localhost:3000/products/\";\n\n        for (let j = 1; j < newProductsList2.length; j++) {\n          if (changeId === j) {\n            fetch(url + j, {\n              headers: {\n                \"Content-Type\": \"application/json\"\n              },\n              method: 'PUT',\n              dataType: \"json\",\n              body: JSON.stringify(newProductsList2[j])\n            }).then(resp => {\n              if (!resp.ok) {\n                throw new Error(\"something is wrong...\");\n              } else {\n                console.log(\"ok -> czyszczenie\");\n                setBasketStep(basketStep + 1);\n                basketSetClear();\n                console.log(resp);\n              }\n            }).catch(err => console.error(err));\n          }\n        }\n      }\n    };\n  }\n\n  componentDidMount() {\n    const url = \"http://localhost:3000/products\";\n    fetch(url).then(response => {\n      return response.json();\n    }).then(products => {\n      this.setState({\n        products: products\n      });\n    }).catch(function (error) {\n      console.log(error);\n    });\n  }\n\n  render() {\n    const {\n      basket,\n      basketSum,\n      currentDelivery,\n      totalSum,\n      priceDisplay,\n      basketStep,\n      handleGoBack\n    } = this.props;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"section\", {\n      className: \"basket-step-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container basket-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(BasketTableProducts, {\n      basketStep: basketStep,\n      basket: basket,\n      priceDisplay: priceDisplay,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(BasketTableSummary, {\n      basketSum: basketSum,\n      currentDelivery: currentDelivery,\n      totalSum: totalSum,\n      priceDisplay: priceDisplay,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"basket-step-btns\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn\",\n      onClick: handleGoBack,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 29\n      }\n    }, \"Wstecz\"), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"btn confirm-btn\",\n      onClick: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 29\n      }\n    }, \"Potwierdzam\")))));\n  }\n\n}\n\nexport default BasketStep3;","map":{"version":3,"sources":["/home/marta/Dokumenty/DYPLOM/copper_shop_template/src/components/shop/basket/basket_step_3/BasketStep3.js"],"names":["React","Component","BasketTableProducts","BasketTableSummary","BasketStep3","state","products","handleSubmit","e","preventDefault","setBasketStep","basketStep","basketSetClear","basket","props","newProductsList","error","changeId","i","length","console","log","j","id","product","push","quantity2","amount","toString","difference","newProductsList2","url","fetch","headers","method","dataType","body","JSON","stringify","then","resp","ok","Error","catch","err","componentDidMount","response","json","setState","render","basketSum","currentDelivery","totalSum","priceDisplay","handleGoBack"],"mappings":";AAAA,OAAOA,KAAP,IAAeC,SAAf,QAA+B,OAA/B;AACA,OAAO,uBAAP;AACA,OAAOC,mBAAP,MAAgC,2DAAhC;AACA,OAAOC,kBAAP,MAA+B,yDAA/B;;AAEA,MAAMC,WAAN,SAA0BH,SAA1B,CACA;AAAA;AAAA;AAAA,SACII,KADJ,GACY;AACJC,MAAAA,QAAQ,EAAE;AADN,KADZ;;AAAA,SAwBIC,YAxBJ,GAwBoBC,CAAD,IACf;AACIA,MAAAA,CAAC,CAACC,cAAF;AAEA,YAAM;AAACH,QAAAA;AAAD,UAAa,KAAKD,KAAxB;AACA,YAAM;AAACK,QAAAA,aAAD;AAAgBC,QAAAA,UAAhB;AAA4BC,QAAAA,cAA5B;AAA4CC,QAAAA;AAA5C,UAAsD,KAAKC,KAAjE;AACAJ,MAAAA,aAAa,CAACC,UAAU,GAAG,CAAd,CAAb;AAEA,UAAII,eAAe,GAAG,CAAC,GAAGT,QAAJ,CAAtB;AACA,UAAIU,KAAK,GAAG,KAAZ;AAEA,UAAIC,QAAQ,GAAG,EAAf;AAEA,UAAIC,CAAC,GAAG,CAAR;;AAEA,aAAOA,CAAC,GAAGL,MAAM,CAACM,MAAlB,GAA2B;AAEvBC,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;;AACA,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGhB,QAAQ,CAACa,MAA7B,EAAqCG,CAAC,EAAtC,EAA0C;AACtCF,UAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;;AAEA,cAAGf,QAAQ,CAACgB,CAAD,CAAR,CAAYC,EAAZ,KAAmBV,MAAM,CAACK,CAAD,CAAN,CAAUM,OAAV,CAAkBD,EAAxC,EACA;AACIN,YAAAA,QAAQ,CAACQ,IAAT,CAAcH,CAAd;AACAP,YAAAA,eAAe,CAACO,CAAD,CAAf,CAAmBI,SAAnB,GAA+B,CAAC,CAACpB,QAAQ,CAACgB,CAAD,CAAR,CAAYI,SAAb,GAAyB,CAACb,MAAM,CAACK,CAAD,CAAN,CAAUS,MAArC,EAA6CC,QAA7C,EAA/B;AACA,gBAAIC,UAAU,GAAG,CAACvB,QAAQ,CAACgB,CAAD,CAAR,CAAYI,SAAb,GAAyB,CAACb,MAAM,CAACK,CAAD,CAAN,CAAUS,MAArD;;AACA,gBAAGE,UAAU,GAAG,CAAhB,EACA;AACIT,cAAAA,OAAO,CAACC,GAAR,CAAY,0CAAZ;AACAL,cAAAA,KAAK,GAAG,IAAR;AACH;AACJ;AACJ;;AACDE,QAAAA,CAAC;AACJ;;AAEDE,MAAAA,OAAO,CAACC,GAAR,CAAYN,eAAZ;AACA,UAAIe,gBAAgB,GAAG,EAAvB;;AAEA,WAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,eAAe,CAACI,MAApC,EAA4CD,CAAC,EAA7C,EACA;AACI,YAAGH,eAAe,CAACG,CAAD,CAAf,KAAuB,OAA1B,EACA;AACIY,UAAAA,gBAAgB,CAACL,IAAjB,CAAsBV,eAAe,CAACG,CAAD,CAArC;AACH;AACJ;;AACDE,MAAAA,OAAO,CAACC,GAAR,CAAYS,gBAAZ;;AAEA,UAAGZ,CAAC,IAAIL,MAAM,CAACM,MAAZ,IAAsB,CAACH,KAA1B,EACA;AACI;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA,cAAMe,GAAG,GAAG,iCAAZ;;AAEA,aAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGQ,gBAAgB,CAACX,MAArC,EAA6CG,CAAC,EAA9C,EAAkD;AAE9C,cAAGL,QAAQ,KAAKK,CAAhB,EACA;AACIU,YAAAA,KAAK,CAACD,GAAG,GAAGT,CAAP,EACD;AACIW,cAAAA,OAAO,EAAE;AAAC,gCAAgB;AAAjB,eADb;AAEIC,cAAAA,MAAM,EAAE,KAFZ;AAGIC,cAAAA,QAAQ,EAAE,MAHd;AAIIC,cAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeR,gBAAgB,CAACR,CAAD,CAA/B;AAJV,aADC,CAAL,CAOCiB,IAPD,CAOMC,IAAI,IAAG;AACT,kBAAI,CAACA,IAAI,CAACC,EAAV,EAAc;AACV,sBAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AACH,eAFD,MAIA;AACItB,gBAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACAX,gBAAAA,aAAa,CAACC,UAAU,GAAG,CAAd,CAAb;AACAC,gBAAAA,cAAc;AACdQ,gBAAAA,OAAO,CAACC,GAAR,CAAYmB,IAAZ;AACH;AACJ,aAlBD,EAmBCG,KAnBD,CAmBOC,GAAG,IAAIxB,OAAO,CAACJ,KAAR,CAAc4B,GAAd,CAnBd;AAoBH;AAEJ;AAGJ;AAEJ,KA7HL;AAAA;;AAKIC,EAAAA,iBAAiB,GAAG;AAEhB,UAAMd,GAAG,GAAG,gCAAZ;AAEAC,IAAAA,KAAK,CAACD,GAAD,CAAL,CACCQ,IADD,CACMO,QAAQ,IAAI;AACd,aAAOA,QAAQ,CAACC,IAAT,EAAP;AACH,KAHD,EAICR,IAJD,CAIMjC,QAAQ,IACd;AACI,WAAK0C,QAAL,CAAc;AACV1C,QAAAA,QAAQ,EAAEA;AADA,OAAd;AAGH,KATD,EAUCqC,KAVD,CAUO,UAAS3B,KAAT,EAAgB;AACnBI,MAAAA,OAAO,CAACC,GAAR,CAAYL,KAAZ;AACH,KAZD;AAaH;;AAyGDiC,EAAAA,MAAM,GAAG;AACL,UAAM;AAACpC,MAAAA,MAAD;AAASqC,MAAAA,SAAT;AAAoBC,MAAAA,eAApB;AAAqCC,MAAAA,QAArC;AAA+CC,MAAAA,YAA/C;AAA6D1C,MAAAA,UAA7D;AAAyE2C,MAAAA;AAAzE,QAAyF,KAAKxC,KAApG;AACA,wBACI,uDACI;AAAS,MAAA,SAAS,EAAC,eAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACI;AAAK,MAAA,SAAS,EAAC,4BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACI,oBAAC,mBAAD;AACI,MAAA,UAAU,EAAEH,UADhB;AAEI,MAAA,MAAM,EAAEE,MAFZ;AAGI,MAAA,YAAY,EAAEwC,YAHlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,eAKI,oBAAC,kBAAD;AACI,MAAA,SAAS,EAAEH,SADf;AAEI,MAAA,eAAe,EAAEC,eAFrB;AAGI,MAAA,QAAQ,EAAEC,QAHd;AAII,MAAA,YAAY,EAAEC,YAJlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MALJ,eAUI;AAAS,MAAA,SAAS,EAAC,kBAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACI;AAAQ,MAAA,SAAS,EAAC,KAAlB;AAAwB,MAAA,OAAO,EAAEC,YAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADJ,eAII;AAAQ,MAAA,SAAS,EAAC,iBAAlB;AAAoC,MAAA,OAAO,EAAE,KAAK/C,YAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAJJ,CAVJ,CADJ,CADJ,CADJ;AAyBH;;AA1JL;;AA6JA,eAAeH,WAAf","sourcesContent":["import React, {Component} from 'react';\nimport \"./_basket_step_3.scss\"\nimport BasketTableProducts from \"../basket_table/basket_table_products/BasketTableProducts\";\nimport BasketTableSummary from \"../basket_table/basket_table_summary/BasketTableSummary\";\n\nclass BasketStep3 extends Component\n{\n    state = {\n        products: [],\n    };\n\n    componentDidMount() {\n\n        const url = \"http://localhost:3000/products\";\n\n        fetch(url)\n        .then(response => {\n            return response.json()\n        })\n        .then(products =>\n        {\n            this.setState({\n                products: products\n            });\n        })\n        .catch(function(error) {\n            console.log(error);\n        });\n    };\n\n    handleSubmit = (e) =>\n    {\n        e.preventDefault();\n\n        const {products} = this.state;\n        const {setBasketStep, basketStep, basketSetClear, basket} = this.props;\n        setBasketStep(basketStep + 1);\n\n        let newProductsList = [...products]\n        let error = false;\n\n        let changeId = [];\n\n        let i = 0;\n\n        for (; i < basket.length;) {\n\n            console.log(\"pętla\");\n            for (let j = 0; j < products.length; j++) {\n                console.log(\"pętla2\")\n\n                if(products[j].id === basket[i].product.id)\n                {\n                    changeId.push(j)\n                    newProductsList[j].quantity2 = (+products[j].quantity2 - +basket[i].amount).toString();\n                    let difference = +products[j].quantity2 - +basket[i].amount;\n                    if(difference < 0)\n                    {\n                        console.log(\"Ktoś już kupił produkt z twojego koszyka\")\n                        error = true;\n                    }\n                }\n            }\n            i++;\n        }\n\n        console.log(newProductsList);\n        let newProductsList2 = [];\n\n        for (let i = 0; i < newProductsList.length; i++)\n        {\n            if(newProductsList[i] !== \"empty\")\n            {\n                newProductsList2.push(newProductsList[i]);\n            }\n        }\n        console.log(newProductsList2);\n\n        if(i >= basket.length && !error)\n        {\n            // const formData = new FormData();\n            // formData.append(\"products\", JSON.stringify(newProductsList2))\n            // //console.log(JSON.stringify(products));\n\n            // const data = {products: newProductsList2}\n            //\n            // console.log(data);\n            // console.log(JSON.stringify(data));\n\n            // const formData = new FormData();\n            //\n            //\n            // formData.append();\n            // for (let i = 0; i < newProductsList2.length; i++) {\n            //     formData.append('id', newProductsList2[i]);\n            // }\n\n\n            const url = \"http://localhost:3000/products/\";\n\n            for (let j = 1; j < newProductsList2.length; j++) {\n\n                if(changeId === j)\n                {\n                    fetch(url + j,\n                        {\n                            headers: {\"Content-Type\": \"application/json\"},\n                            method: 'PUT',\n                            dataType: \"json\",\n                            body: JSON.stringify(newProductsList2[j]),\n                        })\n                    .then(resp =>{\n                        if (!resp.ok) {\n                            throw new Error(\"something is wrong...\");\n                        }\n                        else\n                        {\n                            console.log(\"ok -> czyszczenie\")\n                            setBasketStep(basketStep + 1);\n                            basketSetClear();\n                            console.log(resp);\n                        }\n                    })\n                    .catch(err => console.error(err));\n                }\n\n            }\n\n\n        }\n\n    };\n\n    render() {\n        const {basket, basketSum, currentDelivery, totalSum, priceDisplay, basketStep, handleGoBack} = this.props;\n        return (\n            <>\n                <section className=\"basket-step-3\">\n                    <div className=\"container basket-container\">\n                        <BasketTableProducts\n                            basketStep={basketStep}\n                            basket={basket}\n                            priceDisplay={priceDisplay}/>\n                        <BasketTableSummary\n                            basketSum={basketSum}\n                            currentDelivery={currentDelivery}\n                            totalSum={totalSum}\n                            priceDisplay={priceDisplay}/>\n                        <section className=\"basket-step-btns\">\n                            <button className=\"btn\" onClick={handleGoBack}>\n                                Wstecz\n                            </button>\n                            <button className=\"btn confirm-btn\" onClick={this.handleSubmit} >\n                                Potwierdzam\n                            </button>\n                        </section>\n                    </div>\n                </section>\n            </>\n        )\n    }\n}\n\nexport default BasketStep3;"]},"metadata":{},"sourceType":"module"}